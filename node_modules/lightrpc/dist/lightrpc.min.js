!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.LightRPC=t()}(this,function(){"use strict";function u(e,o){return new Promise(function(n,t){setTimeout(function(){t(new Error("Request has timed out. It should take no longer than "+e+"ms."))},e),o.then(n,t)})}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n=function(){function o(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(n,t,e){return t&&o(n.prototype,t),e&&o(n,e),n}}(),f=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},o=void 0;if("undefined"!=typeof window&&window.fetch){var t=window;o=t.fetch}else o=require("cross-fetch");return function(){function e(n){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof n)throw new Error("InvalidArgument: address has to ba a string");if("object"!==(void 0===t?"undefined":s(t)))throw new Error("InvalidArgument: defaultOptions has to be an object");this.address=n,this.options=f({timeout:5e3,headers:{"Content-Type":"application/json"}},t),this.fetchURL=this.fetchURL.bind(this),this.send=this.send.bind(this)}return n(e,[{key:"fetchURL",value:function(n,t){return o(this.address,{body:JSON.stringify(n),headers:t.headers,method:"post",mode:"cors"})}},{key:"call",value:function(n,t,e,o){var r="function"==typeof e?e:o;this.send({method:n,params:t},e,r)}},{key:"send",value:function(n,t,e){var o="function"==typeof t?t:e,r=this.options;"object"===(void 0===t?"undefined":s(t))&&(r=f({},r,t));var i=f({jsonrpc:"2.0"},n);u(r.timeout,this.fetchURL(i,r)).then(function(n){return n.json()}).then(function(n){if(n.error)throw new Error("Response contains error",n.error);if(!n.result)throw new Error("Response doesn't contain results");return n}).then(function(n){o(null,n.result)}).catch(function(n){return o(n,null)})}},{key:"sendBatch",value:function(n,t,e){var o="function"==typeof t?t:e,r=n.map(function(n){return f({jsonrpc:"2.0"},n)}),i=this.options;"object"===(void 0===t?"undefined":s(t))&&(i=f({},i,t)),u(i.timeout,this.fetchURL(r,i)).then(function(n){return n.json()}).then(function(n){if(n.length<1)throw new Error("Response doesn't contain results");return n}).then(function(n){return o(null,n.map(function(n){return n.result}))}).catch(function(n){return o(n,null)})}}]),e}()});
